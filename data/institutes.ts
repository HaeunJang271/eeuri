export type SupportIntent = "ê²€ì •ê³ ì‹œ" | "ì§„ë¡œ" | "ë©˜íƒˆ" | "í•™êµë°–ì „ë°˜";

type InstituteType =
  | "ê¿ˆë“œë¦¼"
  | "ì²­ì†Œë…„ìƒë‹´ë³µì§€ì„¼í„°"
  | "ê²€ì •ê³ ì‹œí•™ì›"
  | "ì˜¨ë¼ì¸ê°•ì˜"
  | "ì§ì—…í›ˆë ¨"
  | "ë¬¸í™”ê³µê°„";

export interface InstituteInfo {
  id: string;
  type: InstituteType;
  title: string;
  description: string;
  forWho: string;
  pros: string;
  cons?: string;
  exampleSearch: string;
}

// ğŸ”¹ ì‹¤ì œ ê¸°ê´€ ì´ë¦„ì´ ì•„ë‹ˆë¼, "ìœ í˜• + ê²€ìƒ‰ í‚¤ì›Œë“œ"ë¡œ êµ¬ì„±
export const INSTITUTES: InstituteInfo[] = [
  {
    id: "dream-1",
    type: "ê¿ˆë“œë¦¼",
    title: "í•™êµ ë°– ì²­ì†Œë…„ ì§€ì›ì„¼í„°(ê¿ˆë“œë¦¼)",
    description:
      "ê²€ì •ê³ ì‹œ ì¤€ë¹„, ìƒë‹´, ì§„ë¡œ íƒìƒ‰, ë¬¸í™” í™œë™ ë“± í•™êµ ë°– ì²­ì†Œë…„ì„ ìœ„í•œ ì¢…í•© ì§€ì›ì„ ì œê³µí•´.",
    forWho: "í•™êµ ë°– ì²­ì†Œë…„ì´ë¼ë©´ ê±°ì˜ ëˆ„êµ¬ì—ê²Œë‚˜ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´.",
    pros: "ê²€ì •ê³ ì‹œ ìˆ˜ì—…, í•™ìŠµ ë©˜í† , êµí†µë¹„/ê¸‰ì‹ ì§€ì› ë“± ë‹¤ì–‘í•œ ì§€ì›ì„ ë°›ì„ ìˆ˜ ìˆì–´.",
    cons: "ì²˜ìŒ ë°©ë¬¸í•  ë•Œ ì–´ìƒ‰í•˜ê±°ë‚˜ 'ë‚´ê°€ ê´œíˆ ê°€ëŠ” ê±´ê°€â€¦' ì‹¶ì€ ë§ˆìŒì´ ë“¤ ìˆ˜ ìˆì–´.",
    exampleSearch: 'ë„¤ê°€ ì‚¬ëŠ” ì‹œ/êµ¬ ì´ë¦„ + "ê¿ˆë“œë¦¼"',
  },
  {
    id: "counsel-1",
    type: "ì²­ì†Œë…„ìƒë‹´ë³µì§€ì„¼í„°",
    title: "ì²­ì†Œë…„ìƒë‹´ë³µì§€ì„¼í„° / 1388",
    description:
      "ê°ì •, ê°€ì¡±, ì¹œêµ¬ ê´€ê³„, ì§„ë¡œ ê³ ë¯¼ ë“± ì „ë°˜ì ì¸ ì‹¬ë¦¬Â·ì •ì„œ ìƒë‹´ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ê³³ì´ì•¼.",
    forWho: "ìš°ìš¸, ë¶ˆì•ˆ, ë¬´ê¸°ë ¥, ìì¡´ê° ë¬¸ì œë¡œ í˜ë“  ì²­ì†Œë…„.",
    pros: "ë¹„ë°€ì´ ë³´í˜¸ë˜ê³ , ì „ë¬¸ ìƒë‹´ìì™€ ì´ì•¼ê¸°í•  ìˆ˜ ìˆì–´.",
    cons: "ìƒë‹´ ì˜ˆì•½ì„ ê¸°ë‹¤ë ¤ì•¼ í•  ìˆ˜ ìˆê³ , ì²˜ìŒì—” ë§ êº¼ë‚´ëŠ” ê²Œ ì–´ë ¤ìš¸ ìˆ˜ ìˆì–´.",
    exampleSearch: '"ì²­ì†Œë…„ìƒë‹´ë³µì§€ì„¼í„° 1388"',
  },
  {
    id: "academy-1",
    type: "ê²€ì •ê³ ì‹œí•™ì›",
    title: "ê²€ì •ê³ ì‹œ ëŒ€ë¹„ í•™ì›",
    description:
      "ì „ë¬¸ ê°•ì‚¬ì™€ í•¨ê»˜ ê³¼ëª©ë³„ë¡œ ì²´ê³„ì ì¸ ìˆ˜ì—…ì„ ë“¤ìœ¼ë©´ì„œ ê²€ì •ê³ ì‹œë¥¼ ì¤€ë¹„í•  ìˆ˜ ìˆì–´.",
    forWho: "í˜¼ì ê³µë¶€ ë£¨í‹´ ë§Œë“¤ê¸° ì–´ë ¤ìš´ ì‚¬ëŒ, ì§ì ‘ ê°•ì˜ ë“£ê³  ì‹¶ì€ ì‚¬ëŒ.",
    pros: "ì»¤ë¦¬í˜ëŸ¼ì´ ìˆì–´ì„œ ë”°ë¼ê°€ê¸° ì‰½ê³ , ëª¨ë¥´ëŠ” ê±¸ ë°”ë¡œ ì§ˆë¬¸í•  ìˆ˜ ìˆì–´.",
    cons: "í•™ì›ë¹„ê°€ ë“¤ê³ , í†µí•™ ì‹œê°„ì´ í•„ìš”í•  ìˆ˜ ìˆì–´.",
    exampleSearch: 'ë„¤ê°€ ì‚¬ëŠ” ì‹œ/êµ¬ ì´ë¦„ + "ê²€ì •ê³ ì‹œ í•™ì›"',
  },
  {
    id: "online-1",
    type: "ì˜¨ë¼ì¸ê°•ì˜",
    title: "ì˜¨ë¼ì¸ ê²€ì •ê³ ì‹œ ê°•ì˜ (EBS ë“±)",
    description:
      "ì‹œê°„ê³¼ ì¥ì†Œì— êµ¬ì• ë°›ì§€ ì•Šê³  ì¸í„°ë„·ìœ¼ë¡œ ê²€ì •ê³ ì‹œ ê°•ì˜ë¥¼ ë“¤ì„ ìˆ˜ ìˆì–´.",
    forWho: "ìê¸° í…œí¬ë¡œ ê³µë¶€í•˜ê³  ì‹¶ì€ ì‚¬ëŒ, ì™¸ì¶œì´ ë¶€ë‹´ìŠ¤ëŸ¬ìš´ ì‚¬ëŒ.",
    pros: "ë¬´ë£Œ ë˜ëŠ” ì €ë ´í•œ ê°•ì˜ê°€ ë§ê³ , ë°˜ë³µí•´ì„œ ë“¤ì„ ìˆ˜ ìˆì–´.",
    cons: "ìŠ¤ìŠ¤ë¡œ ê³„íšì„ ì„¸ìš°ê³  ê¾¸ì¤€íˆ ë“£ëŠ” í˜ì´ í•„ìš”í•´.",
    exampleSearch: '"EBS ê²€ì •ê³ ì‹œ ê°•ì˜", "ê²€ì •ê³ ì‹œ ì¸ê°•"',
  },
  {
    id: "job-1",
    type: "ì§ì—…í›ˆë ¨",
    title: "ì§ì—…í›ˆë ¨ê¸°ê´€ / í´ë¦¬í… / ë‚´ì¼ë°°ì›€ì¹´ë“œ ê³¼ì •",
    description:
      "ê¸°ìˆ ì´ë‚˜ ì§ì—… ìŠ¤í‚¬ì„ ë°°ìš°ë©´ì„œ ìê²©ì¦ì´ë‚˜ ì·¨ì—…ì„ ì¤€ë¹„í•  ìˆ˜ ìˆì–´.",
    forWho: "ë°”ë¡œ ëŒ€í•™ì´ ì•„ë‹ˆë¼, ì¼ì´ë‚˜ ê¸°ìˆ  ìª½ìœ¼ë¡œ ë¨¼ì € ê°€ë³´ê³  ì‹¶ì€ ì‚¬ëŒ.",
    pros: "ì‹¤ë¬´ ìœ„ì£¼ë¡œ ë°°ìš°ê³ , ì·¨ì—… ì—°ê³„ê°€ ìˆëŠ” ê³¼ì •ë„ ìˆì–´.",
    cons: "ê³¼ì •ì— ë”°ë¼ ë‚œì´ë„ê°€ ë‹¤ë¥´ê³ , ì •ë³´ ì°¾ëŠ” ê²Œ ì¡°ê¸ˆ ë²ˆê±°ë¡œìš¸ ìˆ˜ ìˆì–´.",
    exampleSearch: '"í´ë¦¬í… ì²­ì†Œë…„", "ë‚´ì¼ë°°ì›€ì¹´ë“œ ì§ì—…í›ˆë ¨"',
  },
  {
    id: "culture-1",
    type: "ë¬¸í™”ê³µê°„",
    title: "ì²­ì†Œë…„ ë¬¸í™”ì˜ ì§‘ / ë„ì„œê´€ / ì»¤ë®¤ë‹ˆí‹° ê³µê°„",
    description:
      "ê³µë¶€ë¿ ì•„ë‹ˆë¼, ì‚¬ëŒì„ ë§Œë‚˜ê³  í™œë™ì„ í•˜ë©´ì„œ ì—ë„ˆì§€ë¥¼ ì¶©ì „í•  ìˆ˜ ìˆëŠ” ê³µê°„ì´ì•¼.",
    forWho: "ì§‘-í˜¼ìë§Œ ë°˜ë³µë˜ëŠ” íŒ¨í„´ì´ ë‹µë‹µí•œ ì‚¬ëŒ, ìƒˆë¡œìš´ ìê·¹ì´ í•„ìš”í•œ ì‚¬ëŒ.",
    pros: "ë¬´ë£Œ ë˜ëŠ” ì €ë ´í•˜ê²Œ ì´ìš© ê°€ëŠ¥í•˜ê³ , í”„ë¡œê·¸ë¨ì´ë‚˜ ë™ì•„ë¦¬ë„ ìˆì„ ìˆ˜ ìˆì–´.",
    cons: "ì§ì ‘ ì°¾ì•„ë³´ê³ , ë§ˆìŒì— ë“œëŠ” ê³µê°„ì„ ì°¾ëŠ” ë° ì‹œê°„ì´ í•„ìš”í•  ìˆ˜ ìˆì–´.",
    exampleSearch:
      'ë„¤ê°€ ì‚¬ëŠ” ë™ë„¤ ì´ë¦„ + "ì²­ì†Œë…„ ë¬¸í™”ì˜ ì§‘", "ì²­ì†Œë…„ ë¬¸í™”ê³µê°„"',
  },
];

// ğŸ”¹ ìœ ì €ì˜ ìµœê·¼ ì§ˆë¬¸(í…ìŠ¤íŠ¸) ê¸°ì¤€ìœ¼ë¡œ, ëŒ€ëµ ì–´ë–¤ ì˜ë„ì¸ì§€ ë¶„ë¥˜
export function detectSupportIntent(text: string): SupportIntent[] {
  const lower = text.toLowerCase();

  const intents: SupportIntent[] = [];

  if (
    lower.includes("ê²€ì •ê³ ì‹œ") ||
    lower.includes("ë…í•™") ||
    lower.includes("ì‹œí—˜")
  ) {
    intents.push("ê²€ì •ê³ ì‹œ");
  }

  if (
    lower.includes("ì§„ë¡œ") ||
    lower.includes("ì·¨ì—…") ||
    lower.includes("ì¼ìë¦¬") ||
    lower.includes("ì§ì—…")
  ) {
    intents.push("ì§„ë¡œ");
  }

  if (
    lower.includes("ìš°ìš¸") ||
    lower.includes("ë¶ˆì•ˆ") ||
    lower.includes("ë¬´ê¸°ë ¥") ||
    lower.includes("ì£½ê³  ì‹¶") ||
    lower.includes("ë©˜íƒˆ") ||
    lower.includes("í˜ë“¤")
  ) {
    intents.push("ë©˜íƒˆ");
  }

  if (
    lower.includes("í•™êµ ë°–") ||
    lower.includes("í•™êµë°–") ||
    lower.includes("ìí‡´") ||
    lower.includes("ëŒ€ì•ˆí•™êµ")
  ) {
    intents.push("í•™êµë°–ì „ë°˜");
  }

  // ì•„ë¬´ê²ƒë„ ëª» ì°¾ì•˜ìœ¼ë©´ ì „ì²´ì ì¸ ê±¸ ë‹¤ë£° ìˆ˜ ìˆëŠ” í•™êµë°–ì „ë°˜ ë„£ì–´ì¤Œ
  if (intents.length === 0) {
    intents.push("í•™êµë°–ì „ë°˜");
  }

  return intents;
}

// ğŸ”¹ intentì— ë§ëŠ” ê¸°ê´€ ìœ í˜• í•„í„°ë§
export function getInstitutesForIntent(intent: SupportIntent): InstituteInfo[] {
  switch (intent) {
    case "ê²€ì •ê³ ì‹œ":
      return INSTITUTES.filter((i) =>
        ["ê¿ˆë“œë¦¼", "ê²€ì •ê³ ì‹œí•™ì›", "ì˜¨ë¼ì¸ê°•ì˜", "ì²­ì†Œë…„ìƒë‹´ë³µì§€ì„¼í„°"].includes(
          i.type
        )
      );

    case "ì§„ë¡œ":
      return INSTITUTES.filter((i) =>
        ["ê¿ˆë“œë¦¼", "ì§ì—…í›ˆë ¨", "ë¬¸í™”ê³µê°„", "ì²­ì†Œë…„ìƒë‹´ë³µì§€ì„¼í„°"].includes(
          i.type
        )
      );

    case "ë©˜íƒˆ":
      return INSTITUTES.filter((i) =>
        ["ì²­ì†Œë…„ìƒë‹´ë³µì§€ì„¼í„°", "ê¿ˆë“œë¦¼", "ë¬¸í™”ê³µê°„"].includes(i.type)
      );

    case "í•™êµë°–ì „ë°˜":
    default:
      return INSTITUTES;
  }
}

// ğŸ”¹ LLMì—ê²Œ ë¨¹ì¼ ìˆ˜ ìˆëŠ” "í…ìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸"ë¡œ ë³€í™˜
export function buildInstituteContext(userText: string): string {
  const intents = detectSupportIntent(userText);
  const unique = Array.from(new Set(intents));

  const picked = unique
    .flatMap((intent) => getInstitutesForIntent(intent))
    // ì¤‘ë³µ ì œê±°
    .reduce<InstituteInfo[]>((acc, cur) => {
      if (!acc.find((i) => i.id === cur.id)) acc.push(cur);
      return acc;
    }, []);

  if (picked.length === 0) return "";

  const lines: string[] = [];

  lines.push(
    "ì•„ë˜ëŠ” í•œêµ­ì—ì„œ í•™êµ ë°– ì²­ì†Œë…„ì´ ì´ìš©í•  ìˆ˜ ìˆëŠ” ëŒ€í‘œì ì¸ ì§€ì› ìœ í˜•ì´ì•¼."
  );
  lines.push("ì •í™•í•œ ê¸°ê´€ ì´ë¦„ê³¼ ì—°ë½ì²˜ëŠ” ì‚¬ìš©ìì˜ ì§€ì—­ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆì–´.");
  lines.push(
    "ë„ˆëŠ” ì•„ë˜ ì •ë³´ë¥¼ ì°¸ê³ í•´ì„œ, ê¸°ê´€/í•™ì›/ìƒë‹´ ì„¼í„°ë¥¼ 'ìœ í˜• + ê²€ìƒ‰ í‚¤ì›Œë“œ' ì¤‘ì‹¬ìœ¼ë¡œ ì¶”ì²œí•´ì¤˜."
  );
  lines.push("");

  picked.forEach((inst, index) => {
    lines.push(`---`);
    lines.push(`${index + 1}) **${inst.title}**`);
    lines.push("");
    lines.push(`- ê¸°ëŠ¥: ${inst.description}`);
    lines.push(`- ì¶”ì²œ ëŒ€ìƒ: ${inst.forWho}`);
    lines.push(`- ì¥ì : ${inst.pros}`);
    if (inst.cons) {
      lines.push(`- ìœ ì˜í•  ì : ${inst.cons}`);
    }
    lines.push(`- ê²€ìƒ‰ í‚¤ì›Œë“œ ì˜ˆì‹œ: ${inst.exampleSearch}`);
    lines.push("");
  });

  lines.push("---");

  return lines.join("\n");
}
